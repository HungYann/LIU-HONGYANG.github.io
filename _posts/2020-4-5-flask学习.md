---
layout: post
author: LIU,HONGYANG
tags: [Python]
---



### 运行第一个Flask程序



- 安装flask

```shell
pip install flask
```



- 卸载flask



```shell
pip uninstall flask
```



- 打印flask版本



```
print (flask.__version__)
```



- 第一个Flask程序

  

run中参数:

debug用于是否自动编译运行程序



@app.route是一个装饰器

@app开头，并且在函数上面，说明是装饰器，用于调用debu请求



``` python
from flask import Flask

app = Flask(__name__)


@app.route('/')
def hello_world():
    a =10
    b =0
    c = a/10
    c =1
    d =2
    return "sdfs"

if __name__ == '__main__':
    app.run(debug=True,port=8000,host='0.0.0.0')
```





### debug模式

1.新建一个`config.py`文件

```python
DEBUG=True
```



2.在主app文件中导入这个文件，并且配置到`app`中，示例代码如下：

```python
import config
app.config.from_object(config)
```



3.还有许多其它参数文件，都是放在这个配置文件中，比如`SECRET_KEY`和`SQLALCHEMY`这些都是在配置文件中



```python
from flask import Flask
import config
app = Flask(__name__)
app.config.from_object(config)

@app.route('/')

def hello_world():
    a =10
    b =0
    c = a/10
    c =1
    d =2
    return "sdfs"

if __name__ == '__main__':
    app.run()
```



![image-20200305143131295](https://tva1.sinaimg.cn/large/00831rSTgy1gcj1f9ocwrj311y096765.jpg)



### url传参：



> 1.参数的作用，可以在相同的URL, 但是指定不同的参数，来加载不同的数据

```python
from flask import Flask
import config
app = Flask(__name__)
app.config.from_object(config)

@app.route('/')
def hello_world():
    a =10
    b =0
    c = a/10
    c =1
    d =2
    return "sdfs"

@app.route('/article/<id>')
def article(id):

    id = int(id)+2;
    return u'ther parameter is %s'%id

if __name__ == '__main__':
    app.run()
```



url反转



什么叫做反转URL:

从视图函数到URL的转换叫做反转URL

反转URL的作用：

- 在页面重定向的时候，会使用反转URL
- 在模版中，也会使用URL反转。



如果反转函数需要携带函数，比如id2，则在反转的过程中，就应该添加参数，否则会出错。



第二要注意的url_for的参数应该与方法名保持一致

```python
from flask import Flask,url_for

app =Flask(__name__)

@app.route('/')
def index():
    print (url_for('my_list'))
    print (url_for('article',id2='liuhongyang'))
    return "Hello World"

@app.route('/list/')
def my_list():
    return 'list'

@app.route('/article/<id2>/')
def article(id2):
    return u'您的请求id是%s'%id2


if __name__ == '__main__':
    app.run(debug=True)


```



### 页面跳转和重定向



用处：在用户访问一些需要登录的页面的时候，如果用户没有登录，那么可以让它重定向到登录页面。



>  页面跳转



```python
from flask import Flask,redirect,url_for

app = Flask(__name__)

@app.route('/')
def index():
    login_url = url_for('login')
    return redirect(login_url)
    return u'这是首页'

@app.route('/login/')
def login():
    return u'这是登录页面'

if __name__ == '__main__':
    app.run(debug=True)

```



> 重定向



页面登录重定向：

```python
from flask import Flask,url_for,redirect

app = Flask(__name__)


@app.route('/login/')
def login():
    return u'这是登录页面';

@app.route('/article/<id2>/')
def quesion(id2):
    if id2 == '1':
        return u'这是发布者界面'
    else:
        return redirect(url_for('login'))

if __name__ == '__main__':
    app.run(debug=True)
```





### 模版渲染和参数



- 模版放在`template`文件夹下
- 视图函数中，使用`render_template`函数渲染模版。注：只需要填写模版名字，不需要填写文件夹。

- 如果有多个路径，则`/filename/index.html`



```python
from flask import Flask,render_template

app = Flask(__name__)

@app.route('/')
def index():


    return render_template('index.html',username=u'知了课堂',gender=u'男',age=u'18')

if __name__ == '__main__':
    app.run(debug=True)
```



当有多个参数时，可以使用字典添加多个参数；使用两个**，把字典转换成关键参数传递进去。



```python
from flask import Flask,render_template

app = Flask(__name__)

@app.route('/')
def index():
    context={
        'username':u'知了课堂',
        'gender':u'男',
        'age':18
    }

    return render_template('index.html', ** context)

if __name__ == '__main__':
    app.run(debug=True)
```







![Screenshot 2020-03-06 at 00.13.43](https://tva1.sinaimg.cn/large/00831rSTgy1gcji9dm5y5j30f00ca0to.jpg)





### 模版中访问属性和字典



模版中的参数传递

```python
from flask import Flask, render_template

app = Flask(__name__)

@app.route("/")
def index():
    class Person():
        name = u'liu'
        age = 22

    p = Person()

    context = {
        'username' : u'知了课堂',
        'gender' : u'男',
        'age' : 18,
        'person' : p,
        'websites':{
            'baidu':'www.baidu.com',
            'google':'www.google.com'
        }
    }

    return  render_template("index.html",**context)

if __name__ == '__main__':
    app.run(debug=True)

```



```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello</title>
</head>
<body>
你好
<p>用户名:{{username}}</p>
<p>性别:{{gender}}</p>
<p>年龄:{{age}}</p>
<p></p>

<hr>
<p>名字:{{person.username}}</p>
<p>年龄:{{person.age}}</p>

<hr>
<p>{{websites.baidu}}</p>
<p>{{websites.google}}</p>

</body>
</html>
```



### if 判断语句



```python
from flask import Flask,render_template

app = Flask(__name__)

@app.route('/<login>/')
def index(login):
    if login == '1':

        user = {
            'username':'liuhongyang'
        }

        return render_template('index.html',user=user)
    else:
        return render_template('index.html')


if __name__ == '__main__':
    app.run(debug=True)
```



```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello</title>
</head>
<body>
    {% if user %}
        <a href="#">{{ user.username }}</a>
        <a href="#">注销</a>
    {% else %}
        <a href="#">登录</a>
        <a href="#">注册</a>
    {% endif %}
</body>
</html>
```



### for循环遍历列表和字典



>  字典的遍历，语法和`python`一样，可以使用`items()`、`keys()` 、 `values()` 、 `iteritems()`  、 `iterkeys()`、  `itervalues()`



```python
from flask import Flask,render_template

app = Flask(__name__)

@app.route('/')
def index():

    user={
        'username':u'黄勇',
        'age':18
    }


    return render_template("index.html", user= user)

if __name__ == '__main__':
    app.run(debug=True)

```



```python
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello</title>
</head>
<body>
     {% for k,v in user.items() %}
    <p>{{k}}:{{v}}</p>
     {% endfor %}
</body>
</html>
```



>  列表的遍历



语法和python一样



```python
from flask import Flask,render_template

app = Flask(__name__)

@app.route('/')
def index():



    websites = ['www.baidu.com','www.google.com']

    return render_template("index.html",websites = websites)

if __name__ == '__main__':
    app.run(debug=True)
```





```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello</title>
</head>
<body
     {% for website in websites%}
     <p>{{ website }}</p>
     {% endfor %}
</body>
</html>
```



>  遍历字典



```python
from flask import Flask,render_template

app = Flask(__name__)

@app.route('/')
def index():
    book = [

        {'username': 'liuhongyang',
                'age': 28
        },

        {'name':u'红楼梦',
          'age':2
         }
    ]

    return render_template("index.html", book = book)

if __name__ == '__main__':
    app.run(debug=True)
```



```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello</title>
</head>
<body>


    <table>
        <thead>
            <td>书名</td>
            <td>年龄</td>
        </thead>
        {% for book in book%}
            <tr>
                <td>{{ book.username }}</td>
                <td>{{ book.age }}</td>
            </tr>
        {% endfor %}
    </table>
</body>
</html>

```



### 过滤器



过滤器可以处理变量，把原始的变量经过处理后展示出来。常见的过滤器有`default`和 `length`



```python
from flask import Flask,render_template

app = Flask(__name__)

@app.route('/')
def index():

    comments= [
        {
            'user':'111',
            'content':'222'
        },
        {
            'user':'333',
            'content':'444'
        }
        ,
        {
            'user': '555',
            'content': '666'
        }
    ]

    return render_template('index.html',comments=comments)

if __name__ == '__main__':
    app.run(debug=True)

```



```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello</title>
</head>
<body>

评论数({{ comments|length }})

</body>


</html>

```



### 类的继承



通过类的继承，显示Person的值在Student类中



```python
from flask import Flask,render_template

app = Flask(__name__)

class Person(object):
    name = 'liuhongyang'
    age = 10

class Student(Person):
    pass
  
s = Student()

context = {
    'student':s
}
@app.route('/')
def index():
    return render_template('index.html',context=context)

if __name__ == '__main__':
    app.run(debug=True)
```



```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello</title>
</head>
<body>

姓名：{{context.student.name}}
年龄：{{context.student.age }}
  
</body>
</html>

```



### 继承和Block



>  1.继承作用和语法

- 作用：可以把一些公共代码放在父模版中，避免每个模版写同样的代码
- 语法：



**template08.py**

```python
from flask import Flask,render_template

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('index.html')



@app.route('/login/')
def login():
    return render_template('login.html')


if __name__ == '__main__':
    app.run(debug=True)
```



**base.html**

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
       <style>

        .nav{
            background: #3a3a3a;
            height: 65px;
        }

        ul{
            overflow: hidden;

        }

        ul li{
            float: left;
            list-style: none;
        }

        ul li a{
            color: #fff;
            list-style: none;
            padding: 0 10px;
            line-height: 65px;
        }

    </style>
</head>
<body>


<div class="nav">
    <ul>
            <li><a href="#">首页</a></li>
            <li><a href="#">发布问答</a></li>
    </ul>
</div>


</body>
</html>
```



**index.html**

```html
{% extends 'base.html' %}
```



**login.html**

```html
{% extends 'base.html' %}
```





> 2.block块实现：

作用：

可以让子模版实现自己的需求。父模版需要提前定义好

注意点：子模版中的代码，必须放在block块中



不能够在block外面写代码





**template08.py**

```python
from flask import Flask,render_template

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('index.html')



@app.route('/login/')
def login():
    return render_template('login.html')


if __name__ == '__main__':
    app.run(debug=True)
```



**base.html**



```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}{% endblock %}</title>
       <style>

        .nav{
            background: #3a3a3a;
            height: 65px;
        }

        ul{
            overflow: hidden;

        }

        ul li{
            float: left;
            list-style: none;
        }

        ul li a{
            color: #fff;
            list-style: none;
            padding: 0 10px;
            line-height: 65px;
        }

    </style>
</head>
<body>


<div class="nav">
    <ul>
            <li><a href="#">首页</a></li>
            <li><a href="#">发布问答</a></li>
    </ul>
</div>
{% block main%}

{% endblock %}

</body>
</html>
```



**index.html**

```html
{% extends 'base.html' %}
{% block title %}
登录
{% endblock %}
{% block main %}
<h1>这是登录页面</h1>
{% endblock %}
```



**login.html**

```html
{% extends 'base.html' %}
{% block title %}
首页
{% endblock %}

{% block main %}
<h1>这是首页</h1>
{% endblock%}
```



### URL链接和加载静态文件



**app.py**

```python
from flask import Flask,render_template

app = Flask(__name__)


@app.route('/')
def index():
    return render_template('index.html')


@app.route('/login/')
def login():
    return render_template('login.html')

if __name__ == '__main__':
    app.run()

```



```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="{{ url_for('static',filename='css/index.css') }}">
    <script src="{{ url_for('static',filename='js/index.js') }}"></script>
</head>
<body>
<a href="{{ url_for('login') }}">登录</a>
<img src="{{ url_for('static',filename='images/1.png') }}">

</body>
</html>
```







![image-20200309150758907](https://tva1.sinaimg.cn/large/00831rSTgy1gcnoydtxqcj30gy0gyab9.jpg)



### 数据库



更改Mysql密码

```mysql
mysqladmin -uroot password [root]
mysql -uroot -p
```



使用python连接mysql

```mysql
import mysql.connector
mydb = mysql.connector.connect(host='localhost',user='root',passwd='lhy942821',database='demo')
mycursor = mydb.cursor()
mycursor.execute("SHOW TABLES")
for x in mycursor:  print(x)
```



### 对象关系模型



ORM的好处，可以将数据库中的一个表抽象成一个类，一条数据抽象成该类的一个对象。



ORM与flask_sqlalchemy

 ```shell
pip install flask-sqlalchemy
 ```



https://www.liaoxuefeng.com/wiki/1016959663602400/1017803857459008





