---
layout: post
author: LIU,HONGYANG
tags: [Ansible]
---

查看位数命令：

```
uname -a
```

查看系统版本：

```
cat /etc/os-release
```


下载ssh连接

- 修改hostnmae

```
vim /etc/hostname

sudo reboot
```

- ip地址映射 

```
vim /etc/hosts
```


下载ansible

```
yum install ansible
```

检查ansible版本：

```
ansible --version


ansible 2.9.21
  config file = /etc/ansible/ansible.cfg
  configured module search path = [u'/root/.ansible/plugins/modules', u'/usr/share/ansible/plugins/modules']
  ansible python module location = /usr/lib/python2.7/site-packages/ansible
  executable location = /usr/bin/ansible
  python version = 2.7.5 (default, Nov 16 2020, 22:23:17) [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)]
```


##### 同步本地和服务器文件

使用SFTP

```
{
    "name": "My Server",
    "host": "xxxxxxxx",
    "protocol": "sftp",
    "port": 22,
    "username": "root",
    "remotePath": "/root/ansible-code",
    "uploadOnSave": true
}
```



##### 新机器安装ansible

https://stackoverflow.com/questions/32048021/yum-what-is-the-message-no-package-ansible-available


```
yum install epel-release
yum repolist
yum install ansible
```



s2-vm-02-39 | FAILED! => {
    "msg": "Using a SSH password instead of a key is not possible because Host Key checking is enabled and sshpass does not support this.  Please add this host's fingerprint to your known_hosts file to manage this host."
}



```
ssh root@s2-vm-02-3
```

ansible的 hello world


```
s2-vm-02-39 | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python"
    },
    "changed": false,
    "ping": "pong"
}
```


ansible all -m ping -i inventory.ini



修改ini文件
```
[web1]
s2-vm-02-[1:10] ansible_connection=ssh ansible_user=root ansible_ssh_pass=xxxx
```


生成ssh-keygen

使用

```shell
ssh-copy-id -i ./ssh/ansible s2-vm-02-39
```
复制本地ansible.pub命令到另外一台主机

此时，authorized_key会多一个authorized_keys


此时删除inventory.ini的password密码，并使用
如下命令，可以执行:

```shell
ansible web1 -m ping -i inventory.ini --private-key=/root/.ssh/ansible
```

使用ansible-playbook执行:

```shell
[root@s2-vm-02-39 playbook]#

ansible-playbook playbook2.yml -i ../inventory/inventory.ini --private-key=/root/.ssh/ansible
```





变量的使用

```
[root@s2-vm-02-39 myplaybook]# tree
.
├── inventory
│   └── host
└── main.yml

1 directory, 2 files
```



```
root@s2-vm-02-39 myplaybook]# ansible-playbook -i inventory/host main.yml
```



host内容

```
[all]
s2-vm-02-39

[all:vars]
ansible_user=root
ansible_password=xxxxxx
ansible_connection=ssh
```



ansible.cfg



```
1.当前目录下

2.环境变量配置的

3.home 目录下ansible.cfg

4/etc/ansible/ansible.cfg
```



