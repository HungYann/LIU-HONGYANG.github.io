---
layout: post
author: [LIU,HONGYANG]
tags: [Flume]
---



### 案例需求

监听数据端口案例分析:

1.通过netcat工具想本机的44444端口发送数据

2.Flume监控本机的44444端口。通过Flume的source端读取数据

3.Flume将获取的数据通过Sink端写出到控制台上


![](https://tva1.sinaimg.cn/large/008i3skNly1gr7e2col7zj30ex06074n.jpg)

Flume作用：传输log data, 日志数据        " for insert mode"

首先应该下载`netcat`, 

开启服务端口

```
nc -lk 44444
```

开启客户端

```
nc 44444
```


查看端口是否被占用

```
netstat -tlnp | greo 44444
```

创建job

```
mkdir job
cd job
touch netcat-flume-logger.conf
```

其中`netcat-flume-logger.conf` 监控端口数据

[文件内容](https://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html)



```
# example.conf: A single-node Flume configuration

# Name the components on this agent
# 代表agent中可以有多个组件
# agent的名称需要唯一
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
# 监听端口号
a1.sources.r1.type = netcat
a1.sources.r1.bind = localhost
a1.sources.r1.port = 44444

# Describe the sink
# 定义类型
a1.sinks.k1.type = logger

# Use a channel which buffers events in memory
a1.channels.c1.type = memory
# 缓冲大小(events事件)
a1.channels.c1.capacity = 1000
# 事物相关容量
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
source和sink是1对n的关系
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1

```

执行如下命令




```
bin/flume-ng agent --conf conf --conf-file job/netcat-flume-logger.conf --name a1 -Dflume.root.logger=INFO,console
```


```
bin/flume-ng agent -n a1 -c conf -f job/netcat-flume-logger.conf -Dflume.root.logger=INFO,console
```





日志信息:

```
Info: Sourcing environment configuration script /opt/apache-flume-1.9.0-bin/conf/flume-env.sh
Info: Including Hive libraries found via () for Hive access
+ exec /etc/alternatives/java_sdk/bin/java -Xmx20m -Dflume.root.logger=INFO,console -cp '/opt/apache-flume-1.9.0-bin/conf:/opt/apache-flume-1.9.0-bin/lib/*:/lib/*' -Djava.library.path= org.apache.flume.node.Application --conf-file job/netcat-flume-logger.conf --name a1
2021-06-07 07:18:45,509 (lifecycleSupervisor-1-0) [INFO - org.apache.flume.node.PollingPropertiesFileConfigurationProvider.start(PollingPropertiesFileConfigurationProvider.java:62)] Configuration provider starting
2021-06-07 07:18:45,518 (conf-file-poller-0) [INFO - org.apache.flume.node.PollingPropertiesFileConfigurationProvider$FileWtcherRunnable.run(PollingPropertiesFileConfigurationProvider.java:138)] Reloading configuration file:job/netcat-flume-logger.conf
2021-06-07 07:18:45,529 (conf-file-poller-0) [INFO - org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.addComponentConfig(FlumeConfiguration.java:1203)] Processing:c1
2021-06-07 07:18:45,530 (conf-file-poller-0) [INFO - org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.addComponentConfig(FlumeConfiguration.java:1203)] Processing:c1
2021-06-07 07:18:45,530 (conf-file-poller-0) [INFO - org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.addComponentConfig(FlumeConfiguration.java:1203)] Processing:r1
2021-06-07 07:18:45,530 (conf-file-poller-0) [INFO - org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.addComponentConfig(FlumeConfiguration.java:1203)] Processing:r1
2021-06-07 07:18:45,530 (conf-file-poller-0) [INFO - org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.addComponentConfig(FlumeConfiguration.java:1203)] Processing:r1
2021-06-07 07:18:45,530 (conf-file-poller-0) [INFO - org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.addProperty(FlumeConfiguration.java:1117)] Added sinks: k1 Agent: a1
2021-06-07 07:18:45,531 (conf-file-poller-0) [INFO - org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.addComponentConfig(FlumeConfiguration.java:1203)] Processing:c1
2021-06-07 07:18:45,531 (conf-file-poller-0) [INFO - org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.addComponentConfig(FlumeConfiguration.java:1203)] Processing:k1
2021-06-07 07:18:45,531 (conf-file-poller-0) [INFO - org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.addComponentConfig(FlumeConfiguration.java:1203)] Processing:r1
2021-06-07 07:18:45,531 (conf-file-poller-0) [INFO - org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.addComponentConfig(FlumeConfiguration.java:1203)] Processing:k1
2021-06-07 07:18:45,531 (conf-file-poller-0) [WARN - org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.validateConfigFilterSet(FlumeConfiguration.java:623)] Agent configuration for 'a1' has no configfilters.
2021-06-07 07:18:45,549 (conf-file-poller-0) [INFO - org.apache.flume.conf.FlumeConfiguration.validateConfiguration(FlumeConfiguration.java:163)] Post-validation flume configuration contains configuration for agents: [a1]
2021-06-07 07:18:45,549 (conf-file-poller-0) [INFO - org.apache.flume.node.AbstractConfigurationProvider.loadChannels(AbstractConfigurationProvider.java:151)] Creating channels
2021-06-07 07:18:45,556 (conf-file-poller-0) [INFO - org.apache.flume.channel.DefaultChannelFactory.create(DefaultChannelFactory.java:42)] Creating instance of channel c1 type memory
2021-06-07 07:18:45,561 (conf-file-poller-0) [INFO - org.apache.flume.node.AbstractConfigurationProvider.loadChannels(AbstractConfigurationProvider.java:205)] Created channel c1
2021-06-07 07:18:45,562 (conf-file-poller-0) [INFO - org.apache.flume.source.DefaultSourceFactory.create(DefaultSourceFactory.java:41)] Creating instance of source r1, type avro
2021-06-07 07:18:45,574 (conf-file-poller-0) [INFO - org.apache.flume.sink.DefaultSinkFactory.create(DefaultSinkFactory.java:42)] Creating instance of sink: k1, type: logger
2021-06-07 07:18:45,577 (conf-file-poller-0) [INFO - org.apache.flume.node.AbstractConfigurationProvider.getConfiguration(AbstractConfigurationProvider.java:120)] Channel c1 connected to [r1, k1]
2021-06-07 07:18:45,583 (conf-file-poller-0) [INFO - org.apache.flume.node.Application.startAllComponents(Application.java:162)] Starting new configuration:{ sourceRunners:{r1=EventDrivenSourceRunner: { source:Avro source r1: { bindAddress: localhost, port: 44444 } }} sinkRunners:{k1=SinkRunner: { policy:org.apache.flume.sink.DefaultSinkProcessor@1bd188b7 counterGroup:{ name:null counters:{} } }} channels:{c1=org.apache.flume.channel.MemoryChannel{name: c1}} }
2021-06-07 07:18:45,588 (conf-file-poller-0) [INFO - org.apache.flume.node.Application.startAllComponents(Application.java:169)] Starting Channel c1
2021-06-07 07:18:45,744 (lifecycleSupervisor-1-0) [INFO - org.apache.flume.instrumentation.MonitoredCounterGroup.register(MonitoredCounterGroup.java:119)] Monitored counter group for type: CHANNEL, name: c1: Successfully registered new MBean.
2021-06-07 07:18:45,744 (lifecycleSupervisor-1-0) [INFO - org.apache.flume.instrumentation.MonitoredCounterGroup.start(MonitoredCounterGroup.java:95)] Component type: CHANNEL, name: c1 started
2021-06-07 07:18:45,745 (conf-file-poller-0) [INFO - org.apache.flume.node.Application.startAllComponents(Application.java:196)] Starting Sink k1
2021-06-07 07:18:45,747 (conf-file-poller-0) [INFO - org.apache.flume.node.Application.startAllComponents(Application.java:207)] Starting Source r1
2021-06-07 07:18:45,747 (lifecycleSupervisor-1-4) [INFO - org.apache.flume.source.AvroSource.start(AvroSource.java:193)] Starting Avro source r1: { bindAddress: localhost, port: 44444 }...
2021-06-07 07:18:46,021 (lifecycleSupervisor-1-4) [INFO - org.apache.flume.instrumentation.MonitoredCounterGroup.register(MonitoredCounterGroup.java:119)] Monitored counter group for type: SOURCE, name: r1: Successfully registered new MBean.
2021-06-07 07:18:46,022 (lifecycleSupervisor-1-4) [INFO - org.apache.flume.instrumentation.MonitoredCounterGroup.start(MonitoredCounterGroup.java:95)] Component type: SOURCE, name: r1 started
2021-06-07 07:18:46,026 (lifecycleSupervisor-1-4) [INFO - org.apache.flume.source.AvroSource.start(AvroSource.java:219)] Avro source r1 started.a

```



##### 待学。。。



大数据Flume教程丨大数据业务及数据采集和迁移需求(https://www.bilibili.com/video/BV1tV411U7mu?t=33)



补充：Flume教程(flume框架快速入门)（https://www.bilibili.com/video/BV1cK4y177bb?t=20&p=5）



